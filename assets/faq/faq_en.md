## BitBlik Escrow Service FAQ

Here's a draft FAQ based on the analysis of the BitBlik system's coordinator and client components:

---

### General Questions

**Q1: What is the BitBlik Escrow Service?**
A: BitBlik is a peer-to-peer escrow service designed to facilitate the exchange of assets, primarily focusing on Bitcoin (via the Lightning Network) for fiat currency (specifically using BLIK, a Polish payment system). It uses Lightning Network hold invoices as the core mechanism to secure transactions, ensuring that Bitcoin is only released once the fiat payment is confirmed.

**Q2: Who is this service for?**
A: This service is for individuals who want to buy or sell Bitcoin using BLIK in a more secure manner than direct peer-to-peer transactions without an intermediary.
    *   **Makers** are users looking to sell Bitcoin.
    *   **Takers** are users looking to buy Bitcoin.

**Q3: How does the escrow process work?**
A: The process generally follows these steps:
    1.  **Offer Creation (Maker):** A Maker creates an offer, specifying the amount of Bitcoin (sats) they want to sell and the equivalent fiat amount.
    2.  **Funding Escrow (Maker):** The Maker funds a Lightning Network "hold invoice" for the specified Bitcoin amount. This locks the Bitcoin with the coordinator but doesn't transfer it yet. The coordinator stores a payment hash and a secret preimage.
    3.  **Offer Acceptance (Taker):** A Taker finds an offer they like and accepts it.
    4.  **Fiat Payment (Taker):** The Taker provides their BLIK code to the Maker (facilitated by the system) and makes the fiat payment directly to the Maker.
    5.  **Payment Confirmation (Maker):** The Maker confirms within the BitBlik system that they have received the BLIK payment.
    6.  **Bitcoin Release (Coordinator):** Upon the Maker's confirmation, the coordinator uses the secret preimage to "settle" the hold invoice. This action releases the locked Bitcoin to the Taker's provided Lightning address or invoice.
    7.  **Completion:** The transaction is complete.

**Q4: What is BLIK?**
A: BLIK is a mobile payment system used in Poland. It allows users to make payments using a 6-digit code generated by their banking app. In BitBlik, Takers use BLIK to pay Makers for Bitcoin.

**Q5: What is the Lightning Network (LN)?**
A: The Lightning Network is a "Layer 2" payment protocol built on top of Bitcoin. It enables fast, low-cost transactions. BitBlik uses LN for the Bitcoin side of the trade, specifically utilizing "hold invoices."

**Q6: What are Lightning Network "hold invoices"?**
A: Hold invoices are a special type of Lightning invoice. When a hold invoice is paid by the Maker (seller of Bitcoin), the funds are not immediately settled. Instead, they are "held" by the Maker's LND node (or the coordinator's LND node acting on their behalf). The funds are only truly released (settled) to the recipient (Taker) when a secret "preimage" is revealed. If the preimage is not revealed within a certain time, or if the invoice is explicitly cancelled, the funds are returned to the payer (Maker). This is the core of BitBlik's escrow mechanism.

---

### Security & Risks

**Q7: How are my Bitcoin funds secured as a Maker (seller)?**
A: As a Maker, your Bitcoin is locked via a hold invoice. The coordinator has the preimage required to settle this invoice. The system is designed to only settle (release your Bitcoin to the Taker) *after* you confirm you've received the fiat (BLIK) payment from the Taker. If the Taker fails to pay, or if there's an issue, the hold invoice can be cancelled, and the Bitcoin should be returned to your LND node's control (minus any potential LND routing fees for the failed hold attempt).

**Q8: How am I protected as a Taker (buyer) if I send BLIK payment?**
A: As a Taker, your primary protection is that the Maker has already locked their Bitcoin into a hold invoice with the coordinator *before* you are asked to send the BLIK payment. If the Maker confirms receipt of your BLIK, the system is designed to automatically release the Bitcoin to you. The risk is if the Maker falsely denies receiving your BLIK. (See "Disputes").

**Q9: What happens if the Maker doesn't confirm my BLIK payment even though I sent it?**
A: This is a conflict scenario. The system records various stages of the transaction, including when the BLIK code was provided and when the offer was marked as `blikReceived`. If the Maker fails to confirm, the offer might enter a `conflict` status. The exact dispute resolution mechanism isn't fully detailed in the current code analysis, but this is a critical point of trust or potential manual intervention by the service operator.

**Q10: What happens if the Taker provides a BLIK code but doesn't actually make the payment?**
A: As a Maker, you should not confirm receipt of payment until the fiat funds are actually in your account. If the Taker fails to pay after providing a BLIK code, you would not confirm, and the offer would likely expire or be cancellable. The hold invoice securing your Bitcoin would eventually be cancelled, returning the funds to you.

**Q11: What if the BLIK code provided by the Taker is invalid or expires?**
A: The system allows for an `invalidBlik` status. If the Maker attempts to use the BLIK code and it fails, the transaction cannot proceed. The Taker might need to provide a new code, or the offer might be cancelled.

**Q12: What are the risks of using this service?**
A:
    *   **Counterparty Risk:** The primary risk is the other party not acting honestly (e.g., Taker not paying after Maker locks BTC, or Maker not confirming payment after Taker pays). The hold invoice mechanism mitigates this but doesn't eliminate it, especially around the fiat payment leg.
    *   **Coordinator Trust:** You are trusting the BitBlik coordinator software and its operators to:
        *   Securely manage hold invoice preimages.
        *   Correctly trigger settlements or cancellations based on the process flow.
        *   Operate the service reliably.
    *   **LND Node Issues:** Both the coordinator's LND node and potentially users' LND nodes (if self-hosted and interacting directly) need to be online and operational. Issues with LND nodes can delay or complicate transactions.
    *   **BLIK System Issues:** Problems with the BLIK payment system itself are outside BitBlik's control.
    *   **Software Bugs:** As with any software, there's a risk of bugs in the BitBlik client or coordinator that could lead to errors or loss of funds.
    *   **Privacy:** Your public keys (Lightning node pubkeys) are stored by the coordinator. Transaction details are also stored in the database.

**Q13: Is the coordinator custodial?**
A: The coordinator is non-custodial in the traditional sense for the *final* Bitcoin settlement for the Taker, as it pays out to the Taker's invoice. However, during the escrow period, the Maker's funds are locked in a hold invoice that the coordinator has the power to settle (using the preimage) or instruct to be cancelled. So, there's a temporary control element by the coordinator over the locked funds. The Maker trusts the coordinator to release these funds according to the protocol.

**Q14: What information about me is stored?**
A: The coordinator's database stores:
    *   Offer details (amount, fees, status, timestamps).
    *   Maker and Taker Lightning public keys.
    *   The Taker's Lightning address or invoice for payout.
    *   The BLIK code (temporarily, during the active transaction).
    *   Payment hashes and preimages for hold invoices.

---

### Fees & Technicals

**Q15: Are there any fees for using BitBlik?**
A: Yes, the database schema includes `maker_fees` and `taker_fees` fields for each offer. The exact fee amounts or how they are calculated would be determined by the service operator and displayed in the client application.

**Q16: What happens if a Lightning payment (payout to Taker) fails?**
A: The system has a `takerPaymentFailed` status. If the coordinator attempts to pay the Taker's Lightning invoice and it fails (e.g., Taker's node offline, no route), the transaction might enter this state. The Taker might need to provide a new invoice or resolve issues with their Lightning setup.

**Q17: What does the "funded" status for an offer mean?**
A: This means the Maker has successfully created the offer and the associated hold invoice on the Lightning Network is active and awaiting a Taker to accept the offer and pay the invoice.

**Q18: What if I, as a Maker, want to cancel my offer after funding it but before a Taker accepts?**
A: The system appears to support a `cancelOffer` function. This would cancel the hold invoice, and the Bitcoin should be returned to your LND wallet (less any LND fees). This is typically possible if the offer is still in a `funded` state and not yet `reserved` or further along.

**Q19: What are `LND_HOST`, `LND_CERT_PATH`, `LND_MACAROON_PATH`?**
A: These are configuration settings for the BitBlik coordinator to connect to its Lightning Network Daemon (LND).
    *   `LND_HOST`: The address of the LND node.
    *   `LND_CERT_PATH`: Path to the TLS certificate for secure connection to LND.
    *   `LND_MACAROON_PATH`: Path to the macaroon file, which grants permissions for the coordinator to perform actions on the LND node (like creating/settling invoices).
    These are relevant for the service operator, not typically for end-users of the client app.

**Q20: What if there's a dispute or something goes wrong?**
A: The system has an `OfferStatus.conflict` state. If a transaction reaches this state, it implies a disagreement or an unexpected issue that the automated process cannot resolve. This would likely require manual intervention or a predefined dispute resolution process by the BitBlik service operators. Users should check the service's terms for how disputes are handled.

---
